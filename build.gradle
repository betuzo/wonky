buildscript {
  repositories {
    mavenCentral()
    maven { url "https://plugins.gradle.org/m2/" }
  }
  dependencies {
    classpath "com.github.jengelman.gradle.plugins:shadow:2.0.4"
    classpath "io.spring.gradle:dependency-management-plugin:1.0.5.RELEASE"
    classpath "net.ltgt.gradle:gradle-apt-plugin:0.15"
  }
}

version "0.1"
group "wonky"

apply plugin: "io.spring.dependency-management"
apply plugin: "com.github.johnrengelman.shadow"
apply plugin: "application"
apply plugin: 'groovy'
apply plugin: "net.ltgt.apt-eclipse"
apply plugin: "net.ltgt.apt-idea"
apply plugin: 'jacoco'

repositories {
  mavenLocal()
  mavenCentral()
  maven { url "https://jcenter.bintray.com" }
}

dependencyManagement {
  imports {
    mavenBom 'io.micronaut:bom:1.0.0.M1'
  }
}

dependencies {
  //WARN: It's very important to preserve this order (https://github.com/micronaut-projects/micronaut-core/issues/218#issuecomment-392549294)
  compileOnly 'org.projectlombok:lombok:1.18.0'
  annotationProcessor "org.projectlombok:lombok:1.18.0"
  annotationProcessor "io.micronaut:inject-java"
  compile "io.micronaut:http-client"
  compile "io.micronaut:http-server-netty"
  compile "io.micronaut:inject"
  compile "io.micronaut:runtime"
  compile 'commons-io:commons-io:2.5'
  compile 'io.reactivex:rxnetty-http:0.5.3-rc.1'
  compile "io.micronaut:management"
  compile "io.micronaut:tracing"
  compile 'io.jaegertracing:jaeger-core:0.27.0'
  compileOnly "io.micronaut:inject-java"
  //compileOnly "org.projectlombok:lombok:1.16.22"
  compileOnly "org.codehaus.groovy:groovy-all:2.4.15"

  runtime "ch.qos.logback:logback-classic:1.2.3"
  testCompile "junit:junit:4.12"
  testCompile "io.micronaut:inject-java"
  testCompile "org.codehaus.groovy:groovy-all:2.4.15"
  testCompile "org.spockframework:spock-core:1.1-groovy-2.4"
}

shadowJar {
  mergeServiceFiles()
}

mainClassName = "wonky.Application"
compileJava.options.compilerArgs += '-parameters'
compileTestJava.options.compilerArgs += '-parameters'

jacocoTestReport.dependsOn check

jacocoTestReport {
  reports {
    xml.enabled true
    html.enabled false
  }
}